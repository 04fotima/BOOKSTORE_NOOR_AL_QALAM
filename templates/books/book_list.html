{% extends "_base.html" %}
{% load random_rgba_color %}

{% block title %}
Books
{% endblock title %}

{% block content %}
<div class="mx-auto d-flex flex-column w-100 align-items-center justify-content-start py-4" style="max-width: 80em; background: linear-gradient(135deg, #ffe6f0, #ffccde); border-radius: 20px; box-shadow: 0 8px 30px rgba(255,105,180,0.3);">
    
    <div class="colorin border-bottom border-3 border-pink-strong my-3 py-3 w-100 text-center">
        <h3 class="fs-1 fw-bold gradient-text glow-text" style="color: #d81b60;">All Informations about books üìö‚ú®</h3>
    </div>

    <div class="d-flex flex-wrap justify-content-center w-100" id="book-container" style="max-width: 60em; gap: 1.5rem;">
        {% for book in book_list %}
        <div id="book-cover" class="book-item shadow-lg rounded-4 overflow-hidden animate-fade-in" style="width: 10rem; background: white; transition: transform 0.3s ease, box-shadow 0.3s ease; cursor: pointer;">
            <a href="{{ book.get_absolute_url }}" title="{{ book.title }}" aria-label="book {{ book.title }}" class="text-decoration-none text-dark">
                {% if book.cover %}
                <img class="img-fluid rounded-top" src="{{ book.cover.url }}" alt="{{ book.title }}" style="height: 14rem; width: 100%; object-fit: cover; box-shadow: inset 0 0 12px #ff99cc;">
                {% else %}
                <article class="d-flex justify-content-center align-items-center fw-bold text-center fs-6" style="min-height: 14rem; background-color: {% random_rgba_color 0.5 %}; border-bottom: 3px solid #ff4081; color: #880e4f;">
                    {{ book.title|truncatechars:35 }}
                </article>
                {% endif %}

                <div class="card-body p-3" style="background: #fff0f6;">
                    <h5 class="card-title fw-semibold gradient-text mb-2" style="font-size: 1.2rem; color: #d81b60;">{{ book.title|truncatechars:25 }}</h5>
                    <p class="card-text small mb-1" style="color: #a5274c;">
                        <strong>Author:</strong> {{ book.author }}<br>
                        <strong>Price:</strong> <span class="text-pink fw-bold">${{ book.price }}</span><br>
                        <strong>ISBN:</strong> {{ book.isbn }}<br>
                        <strong>Rating:</strong> <span style="color:#ff4081;">‚≠ê {{ book.rating }} / 5</span>
                    </p>
                    <form method="POST" action="{% url 'add_to_cart' book.id %}" class="d-grid mt-2">
                        {% csrf_token %}
                        <button type="submit" class="btn neon-button btn-buy-now fw-bold py-2 shadow-sm" style="border-radius: 30px;">
                            üõí Buy Now
                        </button>
                    </form>
                </div>
            </a>
        </div>
        {% empty %}
        <p class="text-center fw-bold mt-5" style="color:#d81b60;">No books available at the moment. Please check back later!</p>
        {% endfor %}
    </div>

    <div class="d-flex justify-content-center mt-5 mb-4 w-100">
        {% include 'components/pagination_block.html' %}
    </div>
</div>

<style>
    /* Gradient Text with glow */
    .gradient-text {
        background: linear-gradient(45deg, #ff4081, #ff6f91);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }
    .glow-text {
        text-shadow: 0 0 6px #ff4081, 0 0 12px #ff6f91;
    }

    /* Neon Button */
    .neon-button {
        background: linear-gradient(45deg, #ff4081, #ff6f91);
        color: white;
        border: none;
        box-shadow: 0 4px 15px rgba(255, 64, 129, 0.7);
        transition: all 0.3s ease;
    }
    .neon-button:hover, .neon-button:focus {
        box-shadow: 0 8px 35px rgba(255, 105, 180, 0.9);
        transform: translateY(-3px) scale(1.05);
        outline: none;
    }

    /* Book card hover effect */
    .book-item:hover {
        transform: translateY(-8px) scale(1.05);
        box-shadow: 0 15px 40px rgba(255, 64, 129, 0.7);
        z-index: 2;
    }

    /* Animations */
    @keyframes fadeInUp {
        0% {
            opacity: 0;
            transform: translateY(20px);
        }
        100% {
            opacity: 1;
            transform: translateY(0);
        }
    }
    .animate-fade-in {
        animation: fadeInUp 0.6s ease forwards;
    }
</style>

<script>
    window.addEventListener("load", () => {
        changeSizeContainerBooks();
    })
    window.addEventListener("resize", changeSizeContainerBooks);

    function changeSizeContainerBooks() {
        /* Make responsive books list container height based on items */
        let containerBooks = document.getElementById("book-container");
        let Books = document.getElementsByClassName("book-item");
        const containerWidth = containerBooks.offsetWidth;

        let columns_available = Math.floor(containerWidth / 160);
        let num_items_per_column = Math.ceil(Books.length / columns_available);

        let maxHeight = 0;
        let diff = 0;
        let actualHeight = 0;
        for(let i=0; i<columns_available; i++){
            actualHeight = 0;
            for (let j = diff; j < num_items_per_column + diff; j++) {
                try{
                    actualHeight += Books[j].offsetHeight;
                }catch{}
            }
            if(maxHeight < actualHeight){
                maxHeight = actualHeight;
            }
            diff += num_items_per_column;
        }
        containerBooks.style.height = maxHeight + "px";
        containerBooks.classList.remove("book-animation");
        containerBooks.classList.add("book-animation");
    }
</script>
{% endblock content %}
